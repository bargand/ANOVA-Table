<label for="numTreatments">Number of Treatments:</label>
<input type="number" id="numTreatments" min="1" value="3" />

<label for="numReplications">Number of Replications:</label>
<input type="number" id="numReplications" min="1" value="3" />

<label for="locationInput">Enter Locations (comma-separated):</label>
<input type="text" id="locationInput" placeholder="e.g., Site A, Site B" />

<button onclick="generateTables()">Generate Tables</button>

<div id="tablesContainer"></div>

<button onclick="calculateResults()">Calculate</button>

<div id="resultsContainer"></div>

<script>
  let locationData = {}; // Stores data for each location separately

  function generateTables() {
    const numTreatments =
      parseInt(document.getElementById("numTreatments").value) || 3;
    const numReplications =
      parseInt(document.getElementById("numReplications").value) || 3;
    const locationInput = document.getElementById("locationInput").value.trim();

    if (!locationInput) {
      alert("Please enter at least one location.");
      return;
    }

    const locations = locationInput.split(",").map((loc) => loc.trim()); // Convert input to array
    locationData = {}; // Reset previous location data

    const container = document.getElementById("tablesContainer");
    container.innerHTML = ""; // Clear previous tables

    locations.forEach((location) => {
      locationData[location] = []; // Create an array to store values for this location

      let tableHtml = `
            <h3>${location}</h3>
            <table>
                <thead>
                    <tr>
                        <th>Treatment</th>
                        <th>Replication</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="tableBody-${location}">
                    ${generateRows(location, numTreatments, numReplications)}
                </tbody>
            </table>
        `;
      container.innerHTML += tableHtml;
    });
  }

  function generateRows(location, numTreatments, numReplications) {
    let rowsHtml = "";

    for (let t = 1; t <= numTreatments; t++) {
      for (let r = 1; r <= numReplications; r++) {
        const rowIndex = (t - 1) * numReplications + (r - 1);
        if (!locationData[location][rowIndex]) {
          locationData[location][rowIndex] = {
            treatment: `T${t}`,
            replication: r,
            value: "",
          };
        }

        rowsHtml += `
                <tr>
                    <td>${locationData[location][rowIndex].treatment}</td>
                    <td>${locationData[location][rowIndex].replication}</td>
                    <td>
                        <input type="number" value="${locationData[location][rowIndex].value}" 
                            oninput="updateValue('${location}', ${rowIndex}, this.value)">
                    </td>
                </tr>
            `;
      }
    }
    return rowsHtml;
  }

  function updateValue(location, rowIndex, value) {
    locationData[location][rowIndex].value = value;
  }

  function calculateResults() {
    let resultsContainer = document.getElementById("resultsContainer");
    resultsContainer.innerHTML = "<h3>Results</h3>";

    Object.keys(locationData).forEach((location) => {
      let sum = locationData[location].reduce(
        (acc, row) => acc + (parseFloat(row.value) || 0),
        0
      );
      resultsContainer.innerHTML += `<p>${location}: Sum = ${sum}</p>`;
    });
  }
</script>
